openapi: 3.0.3
info:
  title: WorkFlowN2N API
  description: |
    WorkFlowN2N API for workflow management, plugin integration, and collaboration features.
    
    This API provides endpoints for:
    - Workflow creation, execution, and management
    - Plugin system integration
    - User authentication and authorization
    - Workflow sharing and collaboration
    - Workflow import/export functionality
    
    ## Authentication
    Most endpoints require Bearer token authentication. Include your token in the Authorization header:
    ```
    Authorization: Bearer <your_access_token>
    ```
    
    ## Import/Export Feature
    The workflow import/export system allows you to:
    - Export workflows in JSON or ZIP format
    - Import workflows from files
    - Bulk export multiple workflows
    - Preserve workflow metadata and configurations
  version: 1.0.0
  contact:
    name: WorkFlowN2N Support
    email: support@workflown2n.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8000
    description: Development server
  - url: https://api.workflown2n.com
    description: Production server

security:
  - bearerAuth: []

paths:
  # Workflow Import/Export Endpoints
  /workflows/{workflow_id}/export:
    get:
      tags:
        - Workflow Import/Export
      summary: Export a workflow
      description: |
        Export a single workflow in JSON or ZIP format.
        
        **JSON Format**: Returns the workflow data as a JSON file with metadata.
        
        **ZIP Format**: Returns a ZIP archive containing the workflow JSON file and additional documentation.
      operationId: exportWorkflow
      parameters:
        - name: workflow_id
          in: path
          required: true
          description: The ID of the workflow to export
          schema:
            type: integer
            example: 123
        - name: format
          in: query
          required: false
          description: Export format (json or zip)
          schema:
            type: string
            enum: [json, zip]
            default: json
            example: json
      responses:
        '200':
          description: Workflow exported successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  version:
                    type: string
                    description: Export format version
                    example: "1.0"
                  exported_at:
                    type: string
                    format: date-time
                    description: Export timestamp
                    example: "2024-01-15T10:30:00Z"
                  workflow:
                    $ref: '#/components/schemas/WorkflowExportData'
                  metadata:
                    $ref: '#/components/schemas/ExportMetadata'
              example:
                version: "1.0"
                exported_at: "2024-01-15T10:30:00Z"
                workflow:
                  name: "Data Processing Pipeline"
                  description: "Automated data processing workflow"
                  nodes:
                    - id: "1"
                      type: "input"
                      data:
                        label: "Input Data"
                        config:
                          input_type: "file"
                      position:
                        x: 100
                        y: 50
                  edges: []
                  is_public: false
                  created_at: "2024-01-01T00:00:00Z"
                  updated_at: "2024-01-10T15:30:00Z"
                metadata:
                  exported_by: "john_doe"
                  workflow_id: 123
                  owner:
                    username: "john_doe"
                    email: "john@example.com"
            application/zip:
              schema:
                type: string
                format: binary
              description: ZIP archive containing workflow files
        '400':
          description: Invalid format parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                detail: "Format must be 'json' or 'zip'"
        '403':
          description: User does not have permission to export this workflow
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Workflow not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /workflows/import:
    post:
      tags:
        - Workflow Import/Export
      summary: Import a workflow
      description: |
        Import a workflow from a JSON or ZIP file.
        
        **Supported Formats:**
        - JSON files containing workflow data
        - ZIP archives containing JSON workflow files
        
        **File Structure:**
        The import file should contain workflow data with nodes, edges, and metadata.
      operationId: importWorkflow
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: The workflow file to import (JSON or ZIP)
                name:
                  type: string
                  description: Optional new name for the imported workflow
                  example: "My Imported Workflow"
                description:
                  type: string
                  description: Optional new description for the imported workflow
                  example: "Imported from external source"
                make_public:
                  type: boolean
                  description: Whether to make the imported workflow public
                  default: false
                  example: false
            encoding:
              file:
                contentType: application/json, application/zip, application/x-zip-compressed
      responses:
        '200':
          description: Workflow imported successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowResponse'
              example:
                id: 456
                name: "My Imported Workflow"
                description: "Imported from external source"
                nodes: []
                edges: []
                owner_id: 789
                is_public: false
                created_at: "2024-01-15T10:35:00Z"
                updated_at: "2024-01-15T10:35:00Z"
        '400':
          description: Invalid file format or content
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalid_format:
                  value:
                    detail: "File must be JSON or ZIP format"
                invalid_json:
                  value:
                    detail: "Invalid JSON format: Expecting property name enclosed in double quotes"
                missing_field:
                  value:
                    detail: "Missing required field: name"
                unsupported_version:
                  value:
                    detail: "Unsupported version: 2.0"
        '403':
          description: User does not have permission to create workflows
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                detail: "Not authorized to create workflows"

  /workflows/bulk-export:
    post:
      tags:
        - Workflow Import/Export
      summary: Bulk export workflows
      description: |
        Export multiple workflows as a single ZIP archive.
        
        **Note**: Only workflows that the user has access to will be included in the export.
      operationId: bulkExportWorkflows
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [workflow_ids]
              properties:
                workflow_ids:
                  type: array
                  description: List of workflow IDs to export
                  items:
                    type: integer
                  example: [123, 456, 789]
                format:
                  type: string
                  description: Export format (currently only ZIP is supported)
                  enum: [zip]
                  default: zip
            example:
              workflow_ids: [123, 456, 789]
              format: zip
      responses:
        '200':
          description: Workflows exported successfully
          content:
            application/zip:
              schema:
                type: string
                format: binary
              description: ZIP archive containing multiple workflow files
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                no_workflows:
                  value:
                    detail: "No workflow IDs provided"
                invalid_format:
                  value:
                    detail: "Bulk export only supports ZIP format"
        '404':
          description: No accessible workflows found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                detail: "No accessible workflows found"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT authentication token

  schemas:
    WorkflowExportData:
      type: object
      properties:
        name:
          type: string
          description: Workflow name
          example: "Data Processing Pipeline"
        description:
          type: string
          description: Workflow description
          example: "Automated data processing workflow"
        nodes:
          type: array
          description: Array of workflow nodes
          items:
            type: object
        edges:
          type: array
          description: Array of workflow edges
          items:
            type: object
        is_public:
          type: boolean
          description: Whether the workflow is public
          example: false
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2024-01-01T00:00:00Z"
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
          example: "2024-01-10T15:30:00Z"

    ExportMetadata:
      type: object
      properties:
        exported_by:
          type: string
          description: Username of user who exported the workflow
          example: "john_doe"
        workflow_id:
          type: integer
          description: Original workflow ID
          example: 123
        owner:
          type: object
          properties:
            username:
              type: string
              example: "john_doe"
            email:
              type: string
              format: email
              example: "john@example.com"

    WorkflowResponse:
      type: object
      properties:
        id:
          type: integer
          description: Workflow ID
          example: 456
        name:
          type: string
          description: Workflow name
          example: "My Workflow"
        description:
          type: string
          description: Workflow description
          example: "Automated workflow for data processing"
        nodes:
          type: array
          description: Array of workflow nodes
          items:
            type: object
        edges:
          type: array
          description: Array of workflow edges
          items:
            type: object
        owner_id:
          type: integer
          description: ID of the workflow owner
          example: 789
        is_public:
          type: boolean
          description: Whether the workflow is public
          example: false
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2024-01-15T10:35:00Z"
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
          example: "2024-01-15T10:35:00Z"

    ErrorResponse:
      type: object
      properties:
        detail:
          type: string
          description: Error message
          example: "Workflow not found"

tags:
  - name: Workflow Import/Export
    description: |
      Endpoints for importing and exporting workflows.
      
      These endpoints allow you to:
      - Export individual workflows in JSON or ZIP format
      - Import workflows from files
      - Bulk export multiple workflows at once
      - Preserve workflow metadata and configurations
      
      ## File Formats
      
      ### JSON Format
      ```json
      {
        "version": "1.0",
        "exported_at": "2024-01-15T10:30:00Z",
        "workflow": {
          "name": "Workflow Name",
          "description": "Workflow description",
          "nodes": [...],
          "edges": [...],
          "is_public": false,
          "created_at": "2024-01-01T00:00:00Z",
          "updated_at": "2024-01-10T15:30:00Z"
        },
        "metadata": {
          "exported_by": "username",
          "workflow_id": 123,
          "owner": {
            "username": "owner_username",
            "email": "owner@example.com"
          }
        }
      }
      ```
      
      ### ZIP Format
      ZIP archives contain:
      - `workflow_[name].json`: Main workflow JSON file
      - `README.md`: Import instructions and metadata
      - `manifest.json`: Bulk export manifest (for bulk exports)

  - name: Authentication
    description: User authentication and authorization endpoints
  - name: Workflows
    description: Workflow CRUD operations
  - name: Workflow Execution
    description: Workflow execution and monitoring
  - name: Plugins
    description: Plugin management and execution
  - name: Users
    description: User management endpoints